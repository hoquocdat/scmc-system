generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["public"]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model activity_logs {
  id            String         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id       String?        @db.Uuid
  entity_type   String         @db.VarChar(50)
  entity_id     String         @db.Uuid
  action        String         @db.VarChar(50)
  old_values    Json?
  new_values    Json?
  ip_address    String?        @db.Inet
  user_agent    String?
  created_at    DateTime?      @default(now()) @db.Timestamptz(6)
  user_profiles user_profiles? @relation(fields: [user_id], references: [id], onUpdate: NoAction)

  @@index([entity_type, entity_id], map: "idx_activity_logs_entity")
  @@index([user_id], map: "idx_activity_logs_user")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model bikes {
  id                                               String           @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  brand                                            String           @db.VarChar(100)
  model                                            String           @db.VarChar(100)
  year                                             Int?
  license_plate                                    String           @db.VarChar(20)
  vin                                              String?          @db.VarChar(50)
  engine_number                                    String?          @db.VarChar(50)
  color                                            String?          @db.VarChar(50)
  notes                                            String?
  created_at                                       DateTime?        @default(now()) @db.Timestamptz(6)
  updated_at                                       DateTime?        @default(now()) @db.Timestamptz(6)
  owner_id                                         String?          @db.Uuid
  image_url                                        String?
  created_by_id                                    String?          @db.Uuid
  updated_by_id                                    String?          @db.Uuid
  user_profiles_bikes_created_by_idTouser_profiles user_profiles?   @relation("bikes_created_by_idTouser_profiles", fields: [created_by_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  customers                                        customers?       @relation(fields: [owner_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user_profiles_bikes_updated_by_idTouser_profiles user_profiles?   @relation("bikes_updated_by_idTouser_profiles", fields: [updated_by_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  service_orders                                   service_orders[]

  @@index([created_by_id], map: "idx_bikes_created_by")
  @@index([updated_by_id], map: "idx_bikes_updated_by")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model brands {
  id                String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name              String
  country_of_origin String?
  description       String?
  is_active         Boolean?   @default(true)
  created_at        DateTime?  @default(now()) @db.Timestamptz(6)
  updated_at        DateTime?  @default(now()) @db.Timestamptz(6)
  models            models[]
  parts             parts[]
  products          products[]

  @@index([is_active], map: "idx_brands_is_active")
  @@index([name], map: "idx_brands_name")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model customers {
  id                                                   String                 @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  full_name                                            String                 @db.VarChar(255)
  phone                                                String                 @unique(map: "customers_phone_unique_idx") @db.VarChar(20)
  email                                                String?                @db.VarChar(255)
  id_number                                            String?                @db.VarChar(50)
  address                                              String?
  notes                                                String?
  created_at                                           DateTime?              @default(now()) @db.Timestamptz(6)
  updated_at                                           DateTime?              @default(now()) @db.Timestamptz(6)
  birthday                                             DateTime?              @db.Date
  facebook                                             String?                @db.VarChar(255)
  instagram                                            String?                @db.VarChar(255)
  salesperson_id                                       String?                @db.Uuid
  created_by_id                                        String?                @db.Uuid
  updated_by_id                                        String?                @db.Uuid
  bikes                                                bikes[]
  customer_receivables                                 customer_receivables[]
  user_profiles_customers_created_by_idTouser_profiles user_profiles?         @relation("customers_created_by_idTouser_profiles", fields: [created_by_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  salesperson                                          user_profiles?         @relation("customer_salesperson", fields: [salesperson_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user_profiles_customers_updated_by_idTouser_profiles user_profiles?         @relation("customers_updated_by_idTouser_profiles", fields: [updated_by_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  sales_orders                                         sales_orders[]
  service_orders                                       service_orders[]

  @@index([birthday], map: "idx_customers_birthday")
  @@index([salesperson_id], map: "idx_customers_salesperson")
  @@index([created_by_id], map: "idx_customers_created_by")
  @@index([updated_by_id], map: "idx_customers_updated_by")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model models {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  brand_id    String    @db.Uuid
  name        String
  description String?
  year_from   Int?
  year_to     Int?
  is_active   Boolean?  @default(true)
  created_at  DateTime? @default(now()) @db.Timestamptz(6)
  updated_at  DateTime? @default(now()) @db.Timestamptz(6)
  brands      brands    @relation(fields: [brand_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([brand_id, name])
  @@index([brand_id], map: "idx_models_brand_id")
  @@index([is_active], map: "idx_models_is_active")
  @@index([name], map: "idx_models_name")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model parts {
  id                  String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  part_number         String?         @unique @db.VarChar(50)
  name                String          @db.VarChar(255)
  description         String?
  quantity_in_stock   Int?            @default(0)
  minimum_stock_level Int?            @default(0)
  unit_cost           Decimal?        @db.Decimal(10, 2)
  supplier            String?         @db.VarChar(255)
  created_at          DateTime?       @default(now()) @db.Timestamptz(6)
  updated_at          DateTime?       @default(now()) @db.Timestamptz(6)
  supplier_id         String?         @db.Uuid
  brand_id            String?         @db.Uuid
  brands              brands?         @relation(fields: [brand_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  suppliers           suppliers?      @relation(fields: [supplier_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  service_parts       service_parts[]

  @@index([brand_id], map: "idx_parts_brand_id")
  @@index([supplier_id], map: "idx_parts_supplier_id")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model payments {
  id               String         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  service_order_id String         @db.Uuid
  amount           Decimal        @db.Decimal(10, 2)
  payment_method   payment_method
  is_deposit       Boolean?       @default(false)
  payment_date     DateTime?      @default(now()) @db.Timestamptz(6)
  received_by      String?        @db.Uuid
  notes            String?
  created_at       DateTime?      @default(now()) @db.Timestamptz(6)
  user_profiles    user_profiles? @relation(fields: [received_by], references: [id], onUpdate: NoAction)
  service_orders   service_orders @relation(fields: [service_order_id], references: [id], onUpdate: NoAction)

  @@index([service_order_id], map: "idx_payments_order")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model service_items {
  id                   String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  service_order_id     String          @db.Uuid
  name                 String          @db.VarChar(255)
  description          String?
  status               service_status? @default(pending)
  labor_cost           Decimal?        @default(0) @db.Decimal(10, 2)
  parts_cost           Decimal?        @default(0) @db.Decimal(10, 2)
  hours_worked         Decimal?        @default(0) @db.Decimal(5, 2)
  created_at           DateTime?       @default(now()) @db.Timestamptz(6)
  updated_at           DateTime?       @default(now()) @db.Timestamptz(6)
  assigned_employee_id String?         @db.Uuid
  user_profiles        user_profiles?  @relation(fields: [assigned_employee_id], references: [id], onUpdate: NoAction)
  service_orders       service_orders  @relation(fields: [service_order_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  service_parts        service_parts[]

  @@index([service_order_id], map: "idx_service_items_order")
  @@index([assigned_employee_id], map: "idx_service_items_assigned_employee")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model service_order_comments {
  id               String         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  service_order_id String         @db.Uuid
  user_id          String         @db.Uuid
  comment_text     String
  created_at       DateTime?      @default(now()) @db.Timestamptz(6)
  updated_at       DateTime?      @default(now()) @db.Timestamptz(6)
  service_orders   service_orders @relation(fields: [service_order_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user_profiles    user_profiles  @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([created_at(sort: Desc)], map: "idx_service_order_comments_created_at")
  @@index([service_order_id], map: "idx_service_order_comments_service_order_id")
  @@index([user_id], map: "idx_service_order_comments_user_id")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model service_order_employees {
  id               String         @id(map: "service_order_technicians_pkey") @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  service_order_id String         @db.Uuid
  employee_id      String         @db.Uuid
  assigned_at      DateTime?      @default(now()) @db.Timestamptz(6)
  is_primary       Boolean?       @default(false)
  created_at       DateTime?      @default(now()) @db.Timestamptz(6)
  service_orders   service_orders @relation(fields: [service_order_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "service_order_technicians_service_order_id_fkey")
  user_profiles    user_profiles  @relation(fields: [employee_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "service_order_technicians_technician_id_fkey")

  @@unique([service_order_id, employee_id], map: "service_order_technicians_service_order_id_technician_id_key")
  @@index([employee_id], map: "idx_service_order_employees_employee")
  @@index([service_order_id], map: "idx_service_order_employees_order")
  @@index([service_order_id, is_primary], map: "idx_service_order_employees_primary")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model service_orders {
  id                                                        String                    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  order_number                                              String                    @unique @db.VarChar(20)
  motorcycle_id                                             String                    @db.Uuid
  customer_id                                               String                    @db.Uuid
  assigned_employee_id                                      String?                   @db.Uuid
  status                                                    service_status?           @default(pending)
  priority                                                  priority_level?           @default(normal)
  description                                               String?
  mileage_in                                                Int?
  mileage_out                                               Int?
  drop_off_date                                             DateTime?                 @default(now()) @db.Timestamptz(6)
  estimated_completion_date                                 DateTime?                 @db.Timestamptz(6)
  actual_completion_date                                    DateTime?                 @db.Timestamptz(6)
  pickup_date                                               DateTime?                 @db.Timestamptz(6)
  picked_up_by                                              String?                   @db.VarChar(255)
  pickup_id_verified                                        Boolean?                  @default(false)
  estimated_cost                                            Decimal?                  @db.Decimal(10, 2)
  final_cost                                                Decimal?                  @db.Decimal(10, 2)
  created_at                                                DateTime?                 @default(now()) @db.Timestamptz(6)
  updated_at                                                DateTime?                 @default(now()) @db.Timestamptz(6)
  image_url                                                 String?
  created_by_id                                             String?                   @db.Uuid
  customer_demand                                           String?
  updated_by_id                                             String?                   @db.Uuid
  store_id                                                  String?                   @db.Uuid
  payments                                                  payments[]
  service_items                                             service_items[]
  service_order_comments                                    service_order_comments[]
  service_order_employees                                   service_order_employees[]
  assigned_employee                                         user_profiles?            @relation("assigned_employee", fields: [assigned_employee_id], references: [id], onUpdate: NoAction, map: "service_orders_assigned_technician_id_fkey")
  bikes                                                     bikes                     @relation(fields: [motorcycle_id], references: [id], onUpdate: NoAction, map: "service_orders_bike_id_fkey")
  user_profiles_service_orders_created_by_idTouser_profiles user_profiles?            @relation("service_orders_created_by_idTouser_profiles", fields: [created_by_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  customers                                                 customers                 @relation(fields: [customer_id], references: [id], onUpdate: NoAction)
  stores                                                    stores?                   @relation(fields: [store_id], references: [id], onUpdate: NoAction)
  user_profiles_service_orders_updated_by_idTouser_profiles user_profiles?            @relation("service_orders_updated_by_idTouser_profiles", fields: [updated_by_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  service_parts                                             service_parts[]

  @@index([customer_id], map: "idx_service_orders_customer")
  @@index([assigned_employee_id], map: "idx_service_orders_employee")
  @@index([created_by_id], map: "idx_service_orders_created_by")
  @@index([motorcycle_id], map: "idx_service_orders_motorcycle")
  @@index([order_number], map: "idx_service_orders_order_number")
  @@index([status], map: "idx_service_orders_status")
  @@index([updated_by_id], map: "idx_service_orders_updated_by")
  @@index([store_id], map: "idx_service_orders_store")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model service_parts {
  id               String         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  service_order_id String         @db.Uuid
  service_item_id  String?        @db.Uuid
  part_id          String         @db.Uuid
  quantity_used    Int
  unit_cost        Decimal        @db.Decimal(10, 2)
  total_cost       Decimal?       @db.Decimal(10, 2)
  created_at       DateTime?      @default(now()) @db.Timestamptz(6)
  parts            parts          @relation(fields: [part_id], references: [id], onUpdate: NoAction)
  service_items    service_items? @relation(fields: [service_item_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  service_orders   service_orders @relation(fields: [service_order_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([service_order_id], map: "idx_service_parts_order")
  @@index([part_id], map: "idx_service_parts_part")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model suppliers {
  id                String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name              String
  contact_person    String?
  phone             String?
  email             String?
  address           String?
  notes             String?
  is_active         Boolean?            @default(true)
  created_at        DateTime?           @default(now()) @db.Timestamptz(6)
  updated_at        DateTime?           @default(now()) @db.Timestamptz(6)
  parts             parts[]
  products          products[]
  purchase_orders   purchase_orders[]
  supplier_payments supplier_payments[]
  supplier_returns  supplier_returns[]

  @@index([is_active], map: "idx_suppliers_is_active")
  @@index([name], map: "idx_suppliers_name")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model user_profiles {
  id                                                                    String                    @id @db.Uuid
  role                                                                  user_role
  full_name                                                             String                    @db.VarChar(255)
  phone                                                                 String?                   @db.VarChar(20)
  email                                                                 String?                   @db.VarChar(255)
  is_active                                                             Boolean?                  @default(true)
  created_at                                                            DateTime?                 @default(now()) @db.Timestamptz(6)
  updated_at                                                            DateTime?                 @default(now()) @db.Timestamptz(6)
  activity_logs                                                         activity_logs[]
  ai_usage_logs                                                         ai_usage_logs[]
  bikes_bikes_created_by_idTouser_profiles                              bikes[]                   @relation("bikes_created_by_idTouser_profiles")
  bikes_bikes_updated_by_idTouser_profiles                              bikes[]                   @relation("bikes_updated_by_idTouser_profiles")
  customers_customers_created_by_idTouser_profiles                      customers[]               @relation("customers_created_by_idTouser_profiles")
  customers_salesperson                                                 customers[]               @relation("customer_salesperson")
  customers_customers_updated_by_idTouser_profiles                      customers[]               @relation("customers_updated_by_idTouser_profiles")
  images                                                                images[]
  inventory_transactions                                                inventory_transactions[]
  payments                                                              payments[]
  permission_audit_log_permission_audit_log_performed_byTouser_profiles permission_audit_log[]    @relation("permission_audit_log_performed_byTouser_profiles")
  permission_audit_log_permission_audit_log_user_idTouser_profiles      permission_audit_log[]    @relation("permission_audit_log_user_idTouser_profiles")
  pos_sessions                                                          pos_sessions[]
  purchase_orders_purchase_orders_approved_byTouser_profiles            purchase_orders[]         @relation("purchase_orders_approved_byTouser_profiles")
  purchase_orders_purchase_orders_created_by_idTouser_profiles          purchase_orders[]         @relation("purchase_orders_created_by_idTouser_profiles")
  purchase_orders_purchase_orders_rejected_byTouser_profiles            purchase_orders[]         @relation("purchase_orders_rejected_byTouser_profiles")
  purchase_orders_purchase_orders_submitted_byTouser_profiles           purchase_orders[]         @relation("purchase_orders_submitted_byTouser_profiles")
  purchase_orders_purchase_orders_updated_by_idTouser_profiles          purchase_orders[]         @relation("purchase_orders_updated_by_idTouser_profiles")
  sales_order_payments                                                  sales_order_payments[]
  sales_orders_sales_orders_created_byTouser_profiles                   sales_orders[]            @relation("sales_orders_created_byTouser_profiles")
  sales_orders_sales_orders_processed_byTouser_profiles                 sales_orders[]            @relation("sales_orders_processed_byTouser_profiles")
  service_items                                                         service_items[]
  service_order_comments                                                service_order_comments[]
  service_order_employees                                               service_order_employees[]
  service_orders_assigned_employee                                      service_orders[]          @relation("assigned_employee")
  service_orders_service_orders_created_by_idTouser_profiles            service_orders[]          @relation("service_orders_created_by_idTouser_profiles")
  service_orders_service_orders_updated_by_idTouser_profiles            service_orders[]          @relation("service_orders_updated_by_idTouser_profiles")
  supplier_payments                                                     supplier_payments[]
  supplier_returns_supplier_returns_approved_by_idTouser_profiles       supplier_returns[]        @relation("supplier_returns_approved_by_idTouser_profiles")
  supplier_returns_supplier_returns_created_by_idTouser_profiles        supplier_returns[]        @relation("supplier_returns_created_by_idTouser_profiles")
  transfer_orders_transfer_orders_received_byTouser_profiles            transfer_orders[]         @relation("transfer_orders_received_byTouser_profiles")
  transfer_orders_transfer_orders_requested_byTouser_profiles           transfer_orders[]         @relation("transfer_orders_requested_byTouser_profiles")
  transfer_orders_transfer_orders_shipped_byTouser_profiles             transfer_orders[]         @relation("transfer_orders_shipped_byTouser_profiles")
  user_permissions_user_permissions_assigned_byTouser_profiles          user_permissions[]        @relation("user_permissions_assigned_byTouser_profiles")
  user_permissions_user_permissions_user_idTouser_profiles              user_permissions[]        @relation("user_permissions_user_idTouser_profiles")
  user_roles_user_roles_assigned_byTouser_profiles                      user_roles[]              @relation("user_roles_assigned_byTouser_profiles")
  user_roles_user_roles_user_idTouser_profiles                          user_roles[]              @relation("user_roles_user_idTouser_profiles")

  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model inventory {
  id                 String            @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  location_id        String            @db.Uuid
  product_id         String?           @db.Uuid
  product_variant_id String?           @db.Uuid
  quantity_on_hand   Int?              @default(0)
  quantity_reserved  Int?              @default(0)
  quantity_on_order  Int?              @default(0)
  safety_stock       Int?              @default(0)
  updated_at         DateTime?         @default(now()) @db.Timestamptz(6)
  stock_locations    stock_locations   @relation(fields: [location_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  products           products?         @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  product_variants   product_variants? @relation(fields: [product_variant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([location_id], map: "idx_inventory_location")
  @@index([product_id], map: "idx_inventory_product")
  @@index([product_variant_id], map: "idx_inventory_variant")
  @@schema("public")
}

model inventory_transactions {
  id                 String            @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  location_id        String            @db.Uuid
  product_id         String?           @db.Uuid
  product_variant_id String?           @db.Uuid
  transaction_type   String            @db.VarChar(50)
  quantity           Int
  unit_cost          Decimal?          @db.Decimal(10, 2)
  total_cost         Decimal?          @db.Decimal(10, 2)
  reference_type     String?           @db.VarChar(50)
  reference_id       String?           @db.Uuid
  reason_code        String?           @db.VarChar(50)
  notes              String?
  created_by         String?           @db.Uuid
  created_at         DateTime?         @default(now()) @db.Timestamptz(6)
  user_profiles      user_profiles?    @relation(fields: [created_by], references: [id], onUpdate: NoAction)
  stock_locations    stock_locations   @relation(fields: [location_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  products           products?         @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  product_variants   product_variants? @relation(fields: [product_variant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([created_at(sort: Desc)], map: "idx_inventory_transactions_created_at")
  @@index([location_id], map: "idx_inventory_transactions_location")
  @@index([product_id], map: "idx_inventory_transactions_product")
  @@index([reference_type, reference_id], map: "idx_inventory_transactions_reference")
  @@index([transaction_type], map: "idx_inventory_transactions_type")
  @@index([product_variant_id], map: "idx_inventory_transactions_variant")
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model pos_session_transactions {
  id               String       @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  pos_session_id   String       @db.Uuid
  transaction_type String       @db.VarChar(50)
  amount           Decimal      @db.Decimal(10, 2)
  reason           String?
  notes            String?
  created_at       DateTime?    @default(now()) @db.Timestamptz(6)
  pos_sessions     pos_sessions @relation(fields: [pos_session_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([pos_session_id], map: "idx_pos_session_transactions_session")
  @@index([transaction_type], map: "idx_pos_session_transactions_type")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model pos_sessions {
  id                       String                     @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  session_number           String                     @unique @db.VarChar(50)
  location_id              String                     @db.Uuid
  user_id                  String                     @db.Uuid
  status                   String?                    @default("open") @db.VarChar(50)
  opening_cash             Decimal?                   @default(0) @db.Decimal(10, 2)
  closing_cash             Decimal?                   @db.Decimal(10, 2)
  expected_cash            Decimal?                   @db.Decimal(10, 2)
  cash_difference          Decimal?                   @db.Decimal(10, 2)
  opened_at                DateTime?                  @default(now()) @db.Timestamptz(6)
  closed_at                DateTime?                  @db.Timestamptz(6)
  notes                    String?
  created_at               DateTime?                  @default(now()) @db.Timestamptz(6)
  updated_at               DateTime?                  @default(now()) @db.Timestamptz(6)
  pos_session_transactions pos_session_transactions[]
  stock_locations          stock_locations            @relation(fields: [location_id], references: [id], onUpdate: NoAction)
  user_profiles            user_profiles              @relation(fields: [user_id], references: [id], onUpdate: NoAction)

  @@index([location_id], map: "idx_pos_sessions_location")
  @@index([session_number], map: "idx_pos_sessions_number")
  @@index([opened_at(sort: Desc)], map: "idx_pos_sessions_opened_at")
  @@index([status], map: "idx_pos_sessions_status")
  @@index([user_id], map: "idx_pos_sessions_user")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model product_categories {
  id                       String               @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name                     String               @db.VarChar(255)
  slug                     String               @unique @db.VarChar(255)
  description              String?
  parent_id                String?              @db.Uuid
  display_order            Int?                 @default(0)
  is_active                Boolean?             @default(true)
  created_at               DateTime?            @default(now()) @db.Timestamptz(6)
  updated_at               DateTime?            @default(now()) @db.Timestamptz(6)
  product_categories       product_categories?  @relation("product_categoriesToproduct_categories", fields: [parent_id], references: [id], onUpdate: NoAction)
  other_product_categories product_categories[] @relation("product_categoriesToproduct_categories")
  products                 products[]

  @@index([is_active], map: "idx_product_categories_active")
  @@index([parent_id], map: "idx_product_categories_parent")
  @@index([slug], map: "idx_product_categories_slug")
  @@schema("public")
}

model product_variants {
  id                     String                   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  product_id             String                   @db.Uuid
  sku                    String                   @unique @db.VarChar(100)
  name                   String                   @db.VarChar(255)
  attributes             Json?
  price_adjustment       Decimal?                 @default(0) @db.Decimal(10, 2)
  cost_price_override    Decimal?                 @db.Decimal(10, 2)
  retail_price_override  Decimal?                 @db.Decimal(10, 2)
  is_active              Boolean?                 @default(true)
  created_at             DateTime?                @default(now()) @db.Timestamptz(6)
  updated_at             DateTime?                @default(now()) @db.Timestamptz(6)
  inventory              inventory[]
  inventory_transactions inventory_transactions[]
  products               products                 @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  purchase_order_items   purchase_order_items[]
  sales_order_items      sales_order_items[]
  supplier_return_items  supplier_return_items[]
  transfer_order_items   transfer_order_items[]

  @@index([is_active], map: "idx_product_variants_active")
  @@index([product_id], map: "idx_product_variants_product")
  @@index([sku], map: "idx_product_variants_sku")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model products {
  id                      String                   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  sku                     String                   @unique @db.VarChar(100)
  name                    String                   @db.VarChar(255)
  description             String?
  category_id             String?                  @db.Uuid
  brand_id                String?                  @db.Uuid
  supplier_id             String?                  @db.Uuid
  cost_price              Decimal?                 @default(0) @db.Decimal(10, 2)
  retail_price            Decimal                  @db.Decimal(10, 2)
  sale_price              Decimal?                 @db.Decimal(10, 2)
  sale_price_start_date   DateTime?                @db.Timestamptz(6)
  sale_price_end_date     DateTime?                @db.Timestamptz(6)
  reorder_point           Int?                     @default(0)
  reorder_quantity        Int?                     @default(0)
  product_type            String?                  @default("physical") @db.VarChar(50)
  is_active               Boolean?                 @default(true)
  is_featured             Boolean?                 @default(false)
  weight                  Decimal?                 @db.Decimal(10, 2)
  dimensions_length       Decimal?                 @db.Decimal(10, 2)
  dimensions_width        Decimal?                 @db.Decimal(10, 2)
  dimensions_height       Decimal?                 @db.Decimal(10, 2)
  created_at              DateTime?                @default(now()) @db.Timestamptz(6)
  updated_at              DateTime?                @default(now()) @db.Timestamptz(6)
  master_product_id       String?                  @db.Uuid
  is_master               Boolean?                 @default(true)
  variant_generation_type String?                  @default("manual") @db.VarChar(50)
  attributes              Json?                    @default("{}")
  inventory               inventory[]
  inventory_transactions  inventory_transactions[]
  product_variants        product_variants[]
  brands                  brands?                  @relation(fields: [brand_id], references: [id], onUpdate: NoAction)
  product_categories      product_categories?      @relation(fields: [category_id], references: [id], onUpdate: NoAction)
  products                products?                @relation("productsToproducts", fields: [master_product_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  other_products          products[]               @relation("productsToproducts")
  suppliers               suppliers?               @relation(fields: [supplier_id], references: [id], onUpdate: NoAction)
  purchase_order_items    purchase_order_items[]
  sales_order_items       sales_order_items[]
  supplier_return_items   supplier_return_items[]
  transfer_order_items    transfer_order_items[]

  @@index([is_active], map: "idx_products_active")
  @@index([brand_id], map: "idx_products_brand")
  @@index([category_id], map: "idx_products_category")
  @@index([sku], map: "idx_products_sku")
  @@index([supplier_id], map: "idx_products_supplier")
  @@index([attributes], map: "idx_products_attributes_gin", type: Gin)
  @@index([is_master], map: "idx_products_is_master")
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model sales_order_items {
  id                 String            @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  sales_order_id     String            @db.Uuid
  product_id         String?           @db.Uuid
  product_variant_id String?           @db.Uuid
  product_name       String            @db.VarChar(255)
  product_sku        String?           @db.VarChar(100)
  variant_name       String?           @db.VarChar(255)
  quantity           Int
  unit_price         Decimal           @db.Decimal(10, 2)
  discount_amount    Decimal?          @default(0) @db.Decimal(10, 2)
  tax_amount         Decimal?          @default(0) @db.Decimal(10, 2)
  total_amount       Decimal           @db.Decimal(10, 2)
  unit_cost          Decimal?          @db.Decimal(10, 2)
  notes              String?
  created_at         DateTime?         @default(now()) @db.Timestamptz(6)
  products           products?         @relation(fields: [product_id], references: [id], onUpdate: NoAction)
  product_variants   product_variants? @relation(fields: [product_variant_id], references: [id], onUpdate: NoAction)
  sales_orders       sales_orders      @relation(fields: [sales_order_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([sales_order_id], map: "idx_sales_order_items_order")
  @@index([product_id], map: "idx_sales_order_items_product")
  @@index([product_variant_id], map: "idx_sales_order_items_variant")
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model sales_order_payments {
  id                 String         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  sales_order_id     String         @db.Uuid
  payment_method     String         @db.VarChar(50)
  amount             Decimal        @db.Decimal(10, 2)
  payment_date       DateTime?      @default(now()) @db.Timestamptz(6)
  transaction_id     String?        @db.VarChar(255)
  authorization_code String?        @db.VarChar(100)
  amount_tendered    Decimal?       @db.Decimal(10, 2)
  change_given       Decimal?       @db.Decimal(10, 2)
  status             String?        @default("completed") @db.VarChar(50)
  notes              String?
  received_by        String?        @db.Uuid
  created_at         DateTime?      @default(now()) @db.Timestamptz(6)
  user_profiles      user_profiles? @relation(fields: [received_by], references: [id], onUpdate: NoAction)
  sales_orders       sales_orders   @relation(fields: [sales_order_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([payment_date(sort: Desc)], map: "idx_sales_order_payments_date")
  @@index([payment_method], map: "idx_sales_order_payments_method")
  @@index([sales_order_id], map: "idx_sales_order_payments_order")
  @@index([status], map: "idx_sales_order_payments_status")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model sales_orders {
  id                                                     String                 @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  order_number                                           String                 @unique @db.VarChar(50)
  customer_id                                            String?                @db.Uuid
  customer_name                                          String                 @db.VarChar(255)
  customer_phone                                         String?                @db.VarChar(20)
  customer_email                                         String?                @db.VarChar(255)
  channel                                                String                 @db.VarChar(50)
  location_id                                            String?                @db.Uuid
  status                                                 String?                @default("pending") @db.VarChar(50)
  payment_status                                         String?                @default("unpaid") @db.VarChar(50)
  shipping_address                                       String?
  shipping_city                                          String?                @db.VarChar(100)
  shipping_method                                        String?                @db.VarChar(50)
  tracking_number                                        String?                @db.VarChar(100)
  order_date                                             DateTime?              @default(now()) @db.Timestamptz(6)
  payment_date                                           DateTime?              @db.Timestamptz(6)
  shipped_date                                           DateTime?              @db.Timestamptz(6)
  delivered_date                                         DateTime?              @db.Timestamptz(6)
  subtotal                                               Decimal?               @default(0) @db.Decimal(10, 2)
  discount_amount                                        Decimal?               @default(0) @db.Decimal(10, 2)
  tax_amount                                             Decimal?               @default(0) @db.Decimal(10, 2)
  shipping_cost                                          Decimal?               @default(0) @db.Decimal(10, 2)
  total_amount                                           Decimal                @db.Decimal(10, 2)
  paid_amount                                            Decimal?               @default(0) @db.Decimal(10, 2)
  notes                                                  String?
  internal_notes                                         String?
  created_by                                             String?                @db.Uuid
  processed_by                                           String?                @db.Uuid
  created_at                                             DateTime?              @default(now()) @db.Timestamptz(6)
  updated_at                                             DateTime?              @default(now()) @db.Timestamptz(6)
  discount_type                                          String?                @default("fixed") @db.VarChar(20)
  discount_percent                                       Decimal?               @default(0) @db.Decimal(5, 2)
  store_id                                               String?                @db.Uuid
  customer_receivables                                   customer_receivables?
  sales_order_items                                      sales_order_items[]
  sales_order_payments                                   sales_order_payments[]
  user_profiles_sales_orders_created_byTouser_profiles   user_profiles?         @relation("sales_orders_created_byTouser_profiles", fields: [created_by], references: [id], onUpdate: NoAction)
  customers                                              customers?             @relation(fields: [customer_id], references: [id], onUpdate: NoAction)
  stock_locations                                        stock_locations?       @relation(fields: [location_id], references: [id], onUpdate: NoAction)
  user_profiles_sales_orders_processed_byTouser_profiles user_profiles?         @relation("sales_orders_processed_byTouser_profiles", fields: [processed_by], references: [id], onUpdate: NoAction)
  stores                                                 stores?                @relation(fields: [store_id], references: [id], onUpdate: NoAction)

  @@index([channel], map: "idx_sales_orders_channel")
  @@index([customer_id], map: "idx_sales_orders_customer")
  @@index([customer_phone], map: "idx_sales_orders_customer_phone")
  @@index([location_id], map: "idx_sales_orders_location")
  @@index([order_number], map: "idx_sales_orders_number")
  @@index([order_date(sort: Desc)], map: "idx_sales_orders_order_date")
  @@index([payment_status], map: "idx_sales_orders_payment_status")
  @@index([status], map: "idx_sales_orders_status")
  @@index([store_id], map: "idx_sales_orders_store")
  @@schema("public")
}

model stock_locations {
  id                                                                String                   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name                                                              String                   @db.VarChar(255)
  code                                                              String                   @unique @db.VarChar(50)
  address                                                           String?
  city                                                              String?                  @db.VarChar(100)
  phone                                                             String?                  @db.VarChar(20)
  is_active                                                         Boolean?                 @default(true)
  is_default                                                        Boolean?                 @default(false)
  created_at                                                        DateTime?                @default(now()) @db.Timestamptz(6)
  updated_at                                                        DateTime?                @default(now()) @db.Timestamptz(6)
  inventory                                                         inventory[]
  inventory_transactions                                            inventory_transactions[]
  pos_sessions                                                      pos_sessions[]
  sales_orders                                                      sales_orders[]
  stores                                                            stores[]
  transfer_orders_transfer_orders_from_location_idTostock_locations transfer_orders[]        @relation("transfer_orders_from_location_idTostock_locations")
  transfer_orders_transfer_orders_to_location_idTostock_locations   transfer_orders[]        @relation("transfer_orders_to_location_idTostock_locations")

  @@index([is_active], map: "idx_stock_locations_active")
  @@index([code], map: "idx_stock_locations_code")
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model transfer_order_items {
  id                 String            @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  transfer_order_id  String            @db.Uuid
  product_id         String?           @db.Uuid
  product_variant_id String?           @db.Uuid
  quantity_requested Int
  quantity_shipped   Int?              @default(0)
  quantity_received  Int?              @default(0)
  notes              String?
  created_at         DateTime?         @default(now()) @db.Timestamptz(6)
  updated_at         DateTime?         @default(now()) @db.Timestamptz(6)
  products           products?         @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  product_variants   product_variants? @relation(fields: [product_variant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  transfer_orders    transfer_orders   @relation(fields: [transfer_order_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([product_id], map: "idx_transfer_order_items_product")
  @@index([transfer_order_id], map: "idx_transfer_order_items_transfer")
  @@index([product_variant_id], map: "idx_transfer_order_items_variant")
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model transfer_orders {
  id                                                                String                 @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  transfer_number                                                   String                 @unique @db.VarChar(50)
  from_location_id                                                  String                 @db.Uuid
  to_location_id                                                    String                 @db.Uuid
  status                                                            String?                @default("pending") @db.VarChar(50)
  requested_date                                                    DateTime?              @default(now()) @db.Timestamptz(6)
  shipped_date                                                      DateTime?              @db.Timestamptz(6)
  received_date                                                     DateTime?              @db.Timestamptz(6)
  requested_by                                                      String?                @db.Uuid
  shipped_by                                                        String?                @db.Uuid
  received_by                                                       String?                @db.Uuid
  notes                                                             String?
  created_at                                                        DateTime?              @default(now()) @db.Timestamptz(6)
  updated_at                                                        DateTime?              @default(now()) @db.Timestamptz(6)
  transfer_order_items                                              transfer_order_items[]
  stock_locations_transfer_orders_from_location_idTostock_locations stock_locations        @relation("transfer_orders_from_location_idTostock_locations", fields: [from_location_id], references: [id], onUpdate: NoAction)
  user_profiles_transfer_orders_received_byTouser_profiles          user_profiles?         @relation("transfer_orders_received_byTouser_profiles", fields: [received_by], references: [id], onUpdate: NoAction)
  user_profiles_transfer_orders_requested_byTouser_profiles         user_profiles?         @relation("transfer_orders_requested_byTouser_profiles", fields: [requested_by], references: [id], onUpdate: NoAction)
  user_profiles_transfer_orders_shipped_byTouser_profiles           user_profiles?         @relation("transfer_orders_shipped_byTouser_profiles", fields: [shipped_by], references: [id], onUpdate: NoAction)
  stock_locations_transfer_orders_to_location_idTostock_locations   stock_locations        @relation("transfer_orders_to_location_idTostock_locations", fields: [to_location_id], references: [id], onUpdate: NoAction)

  @@index([from_location_id], map: "idx_transfer_orders_from_location")
  @@index([transfer_number], map: "idx_transfer_orders_number")
  @@index([status], map: "idx_transfer_orders_status")
  @@index([to_location_id], map: "idx_transfer_orders_to_location")
  @@schema("public")
}

model images {
  id             String            @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  entity_type    image_entity_type
  entity_id      String            @db.Uuid
  file_path      String
  file_name      String
  file_size      Int?
  mime_type      String?           @db.VarChar(100)
  storage_bucket String            @default("bikes") @db.VarChar(100)
  public_url     String
  display_order  Int?              @default(0)
  is_primary     Boolean?          @default(false)
  uploaded_by    String?           @db.Uuid
  created_at     DateTime?         @default(now()) @db.Timestamptz(6)
  updated_at     DateTime?         @default(now()) @db.Timestamptz(6)
  user_profiles  user_profiles?    @relation(fields: [uploaded_by], references: [id], onUpdate: NoAction)

  @@index([entity_type, entity_id], map: "idx_images_entity")
  @@index([entity_id], map: "idx_images_entity_id")
  @@index([entity_type, entity_id, is_primary], map: "idx_images_is_primary")
  @@index([uploaded_by], map: "idx_images_uploaded_by")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model attribute_definitions {
  id                   String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name                 String    @db.VarChar(100)
  slug                 String    @unique @db.VarChar(100)
  description          String?
  input_type           String?   @default("select") @db.VarChar(50)
  data_type            String?   @default("string") @db.VarChar(50)
  is_variant_attribute Boolean?  @default(true)
  is_filterable        Boolean?  @default(true)
  is_required          Boolean?  @default(false)
  options              Json?     @default("[]")
  validation_rules     Json?     @default("{}")
  display_order        Int?      @default(0)
  icon                 String?   @db.VarChar(100)
  help_text            String?
  is_active            Boolean?  @default(true)
  created_at           DateTime? @default(now()) @db.Timestamptz(6)
  updated_at           DateTime? @default(now()) @db.Timestamptz(6)

  @@index([is_active], map: "idx_attr_def_active")
  @@index([options], map: "idx_attr_def_options_gin", type: Gin)
  @@index([display_order], map: "idx_attr_def_order")
  @@index([slug], map: "idx_attr_def_slug")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model permission_audit_log {
  id                                                             String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id                                                        String?        @db.Uuid
  action                                                         String         @db.VarChar(50)
  resource_type                                                  String?        @db.VarChar(100)
  resource_id                                                    String?        @db.Uuid
  changes                                                        Json?
  performed_by                                                   String?        @db.Uuid
  created_at                                                     DateTime       @default(now()) @db.Timestamptz(6)
  user_profiles_permission_audit_log_performed_byTouser_profiles user_profiles? @relation("permission_audit_log_performed_byTouser_profiles", fields: [performed_by], references: [id], onUpdate: NoAction)
  user_profiles_permission_audit_log_user_idTouser_profiles      user_profiles? @relation("permission_audit_log_user_idTouser_profiles", fields: [user_id], references: [id], onUpdate: NoAction)

  @@index([created_at(sort: Desc)], map: "idx_permission_audit_log_created_at")
  @@index([performed_by], map: "idx_permission_audit_log_performed_by")
  @@index([user_id], map: "idx_permission_audit_log_user_id")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model permissions {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name             String             @unique @db.VarChar(255)
  resource         String             @db.VarChar(100)
  action           String             @db.VarChar(50)
  conditions       Json?
  description      String?
  created_at       DateTime           @default(now()) @db.Timestamptz(6)
  updated_at       DateTime           @default(now()) @db.Timestamptz(6)
  role_permissions role_permissions[]
  user_permissions user_permissions[]

  @@index([resource, action], map: "idx_permissions_resource_action")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model role_permissions {
  role_id       String      @db.Uuid
  permission_id String      @db.Uuid
  created_at    DateTime    @default(now()) @db.Timestamptz(6)
  permissions   permissions @relation(fields: [permission_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  roles         roles       @relation(fields: [role_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([role_id, permission_id])
  @@index([permission_id], map: "idx_role_permissions_permission_id")
  @@index([role_id], map: "idx_role_permissions_role_id")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model roles {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name             String             @unique @db.VarChar(100)
  description      String?
  is_system        Boolean?           @default(false)
  created_at       DateTime           @default(now()) @db.Timestamptz(6)
  updated_at       DateTime           @default(now()) @db.Timestamptz(6)
  role_permissions role_permissions[]
  user_roles       user_roles[]

  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model user_roles {
  user_id                                             String         @db.Uuid
  role_id                                             String         @db.Uuid
  assigned_at                                         DateTime       @default(now()) @db.Timestamptz(6)
  assigned_by                                         String?        @db.Uuid
  user_profiles_user_roles_assigned_byTouser_profiles user_profiles? @relation("user_roles_assigned_byTouser_profiles", fields: [assigned_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  roles                                               roles          @relation(fields: [role_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user_profiles_user_roles_user_idTouser_profiles     user_profiles  @relation("user_roles_user_idTouser_profiles", fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([user_id, role_id])
  @@index([role_id], map: "idx_user_roles_role_id")
  @@index([user_id], map: "idx_user_roles_user_id")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model user_permissions {
  user_id                                                   String         @db.Uuid
  permission_id                                             String         @db.Uuid
  granted                                                   Boolean        @default(true)
  assigned_at                                               DateTime?      @default(now()) @db.Timestamptz(6)
  assigned_by                                               String?        @db.Uuid
  reason                                                    String?
  user_profiles_user_permissions_assigned_byTouser_profiles user_profiles? @relation("user_permissions_assigned_byTouser_profiles", fields: [assigned_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  permissions                                               permissions    @relation(fields: [permission_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user_profiles_user_permissions_user_idTouser_profiles     user_profiles  @relation("user_permissions_user_idTouser_profiles", fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([user_id, permission_id])
  @@index([granted], map: "idx_user_permissions_granted")
  @@index([permission_id], map: "idx_user_permissions_permission_id")
  @@index([user_id], map: "idx_user_permissions_user_id")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model ai_usage_logs {
  id                String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id           String?        @db.Uuid
  action            String         @db.VarChar(100)
  model             String         @db.VarChar(100)
  prompt_tokens     Int            @default(0)
  completion_tokens Int            @default(0)
  total_tokens      Int            @default(0)
  estimated_cost    Decimal?       @default(0) @db.Decimal(10, 6)
  request_payload   Json?
  response_summary  String?
  status            String         @default("success") @db.VarChar(20)
  error_message     String?
  duration_ms       Int?
  created_at        DateTime       @default(now()) @db.Timestamptz(6)
  user_profiles     user_profiles? @relation(fields: [user_id], references: [id], onUpdate: NoAction)

  @@index([action], map: "idx_ai_usage_logs_action")
  @@index([created_at], map: "idx_ai_usage_logs_created_at")
  @@index([model], map: "idx_ai_usage_logs_model")
  @@index([user_id], map: "idx_ai_usage_logs_user_id")
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model purchase_order_items {
  id                    String                  @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  purchase_order_id     String                  @db.Uuid
  product_id            String?                 @db.Uuid
  product_variant_id    String?                 @db.Uuid
  product_name          String                  @db.VarChar(255)
  product_sku           String?                 @db.VarChar(100)
  variant_name          String?                 @db.VarChar(255)
  quantity_ordered      Int
  quantity_received     Int?                    @default(0)
  quantity_returned     Int?                    @default(0)
  unit_cost             Decimal                 @db.Decimal(10, 2)
  total_cost            Decimal                 @db.Decimal(10, 2)
  notes                 String?
  created_at            DateTime?               @default(now()) @db.Timestamptz(6)
  updated_at            DateTime?               @default(now()) @db.Timestamptz(6)
  products              products?               @relation(fields: [product_id], references: [id], onDelete: Restrict, onUpdate: NoAction)
  product_variants      product_variants?       @relation(fields: [product_variant_id], references: [id], onDelete: Restrict, onUpdate: NoAction)
  purchase_orders       purchase_orders         @relation(fields: [purchase_order_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  supplier_return_items supplier_return_items[]

  @@index([purchase_order_id], map: "idx_purchase_order_items_po")
  @@index([product_id], map: "idx_purchase_order_items_product")
  @@index([product_variant_id], map: "idx_purchase_order_items_variant")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model purchase_orders {
  id                                                         String                         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  order_number                                               String                         @unique @db.VarChar(50)
  supplier_id                                                String                         @db.Uuid
  status                                                     purchase_order_status          @default(draft)
  payment_status                                             purchase_order_payment_status  @default(unpaid)
  subtotal                                                   Decimal                        @default(0) @db.Decimal(10, 2)
  tax_amount                                                 Decimal?                       @default(0) @db.Decimal(10, 2)
  shipping_cost                                              Decimal?                       @default(0) @db.Decimal(10, 2)
  discount_amount                                            Decimal?                       @default(0) @db.Decimal(10, 2)
  total_amount                                               Decimal                        @default(0) @db.Decimal(10, 2)
  paid_amount                                                Decimal                        @default(0) @db.Decimal(10, 2)
  order_date                                                 DateTime?                      @default(now()) @db.Timestamptz(6)
  expected_delivery_date                                     DateTime?                      @db.Timestamptz(6)
  actual_delivery_date                                       DateTime?                      @db.Timestamptz(6)
  submitted_at                                               DateTime?                      @db.Timestamptz(6)
  submitted_by                                               String?                        @db.Uuid
  approved_at                                                DateTime?                      @db.Timestamptz(6)
  approved_by                                                String?                        @db.Uuid
  rejected_at                                                DateTime?                      @db.Timestamptz(6)
  rejected_by                                                String?                        @db.Uuid
  rejection_reason                                           String?
  stock_updated                                              Boolean?                       @default(false)
  stock_updated_at                                           DateTime?                      @db.Timestamptz(6)
  notes                                                      String?
  internal_notes                                             String?
  created_by_id                                              String?                        @db.Uuid
  updated_by_id                                              String?                        @db.Uuid
  created_at                                                 DateTime?                      @default(now()) @db.Timestamptz(6)
  updated_at                                                 DateTime?                      @default(now()) @db.Timestamptz(6)
  purchase_order_items                                       purchase_order_items[]
  user_profiles_purchase_orders_approved_byTouser_profiles   user_profiles?                 @relation("purchase_orders_approved_byTouser_profiles", fields: [approved_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user_profiles_purchase_orders_created_by_idTouser_profiles user_profiles?                 @relation("purchase_orders_created_by_idTouser_profiles", fields: [created_by_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user_profiles_purchase_orders_rejected_byTouser_profiles   user_profiles?                 @relation("purchase_orders_rejected_byTouser_profiles", fields: [rejected_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user_profiles_purchase_orders_submitted_byTouser_profiles  user_profiles?                 @relation("purchase_orders_submitted_byTouser_profiles", fields: [submitted_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  suppliers                                                  suppliers                      @relation(fields: [supplier_id], references: [id], onUpdate: NoAction)
  user_profiles_purchase_orders_updated_by_idTouser_profiles user_profiles?                 @relation("purchase_orders_updated_by_idTouser_profiles", fields: [updated_by_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  supplier_payment_allocations                               supplier_payment_allocations[]
  supplier_returns                                           supplier_returns[]

  @@index([approved_by], map: "idx_purchase_orders_approved_by")
  @@index([created_by_id], map: "idx_purchase_orders_created_by")
  @@index([order_date(sort: Desc)], map: "idx_purchase_orders_order_date")
  @@index([order_number], map: "idx_purchase_orders_order_number")
  @@index([payment_status], map: "idx_purchase_orders_payment_status")
  @@index([status], map: "idx_purchase_orders_status")
  @@index([supplier_id], map: "idx_purchase_orders_supplier")
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model supplier_payment_allocations {
  id                  String            @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  supplier_payment_id String            @db.Uuid
  purchase_order_id   String            @db.Uuid
  amount_allocated    Decimal           @db.Decimal(10, 2)
  created_at          DateTime?         @default(now()) @db.Timestamptz(6)
  purchase_orders     purchase_orders   @relation(fields: [purchase_order_id], references: [id], onUpdate: NoAction)
  supplier_payments   supplier_payments @relation(fields: [supplier_payment_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([supplier_payment_id], map: "idx_supplier_payment_allocations_payment")
  @@index([purchase_order_id], map: "idx_supplier_payment_allocations_po")
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model supplier_payments {
  id                           String                         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  supplier_id                  String                         @db.Uuid
  payment_number               String                         @unique @db.VarChar(50)
  amount                       Decimal                        @db.Decimal(10, 2)
  payment_method               payment_method
  payment_date                 DateTime?                      @default(now()) @db.Timestamptz(6)
  transaction_id               String?                        @db.VarChar(255)
  reference_number             String?                        @db.VarChar(100)
  notes                        String?
  created_by_id                String?                        @db.Uuid
  created_at                   DateTime?                      @default(now()) @db.Timestamptz(6)
  updated_at                   DateTime?                      @default(now()) @db.Timestamptz(6)
  supplier_payment_allocations supplier_payment_allocations[]
  user_profiles                user_profiles?                 @relation(fields: [created_by_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  suppliers                    suppliers                      @relation(fields: [supplier_id], references: [id], onUpdate: NoAction)

  @@index([created_by_id], map: "idx_supplier_payments_created_by")
  @@index([payment_date(sort: Desc)], map: "idx_supplier_payments_date")
  @@index([payment_number], map: "idx_supplier_payments_number")
  @@index([supplier_id], map: "idx_supplier_payments_supplier")
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model supplier_return_items {
  id                     String               @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  supplier_return_id     String               @db.Uuid
  purchase_order_item_id String               @db.Uuid
  product_id             String?              @db.Uuid
  product_variant_id     String?              @db.Uuid
  quantity_returned      Int
  unit_cost              Decimal              @db.Decimal(10, 2)
  total_cost             Decimal              @db.Decimal(10, 2)
  reason                 String?
  created_at             DateTime?            @default(now()) @db.Timestamptz(6)
  products               products?            @relation(fields: [product_id], references: [id], onDelete: Restrict, onUpdate: NoAction)
  product_variants       product_variants?    @relation(fields: [product_variant_id], references: [id], onDelete: Restrict, onUpdate: NoAction)
  purchase_order_items   purchase_order_items @relation(fields: [purchase_order_item_id], references: [id], onUpdate: NoAction)
  supplier_returns       supplier_returns     @relation(fields: [supplier_return_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([purchase_order_item_id], map: "idx_supplier_return_items_po_item")
  @@index([product_id], map: "idx_supplier_return_items_product")
  @@index([supplier_return_id], map: "idx_supplier_return_items_return")
  @@index([product_variant_id], map: "idx_supplier_return_items_variant")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model supplier_returns {
  id                                                           String                  @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  return_number                                                String                  @unique @db.VarChar(50)
  supplier_id                                                  String                  @db.Uuid
  purchase_order_id                                            String                  @db.Uuid
  return_date                                                  DateTime?               @default(now()) @db.Timestamptz(6)
  total_return_amount                                          Decimal                 @default(0) @db.Decimal(10, 2)
  reason                                                       String?
  notes                                                        String?
  status                                                       String?                 @default("pending") @db.VarChar(50)
  created_by_id                                                String?                 @db.Uuid
  approved_by_id                                               String?                 @db.Uuid
  created_at                                                   DateTime?               @default(now()) @db.Timestamptz(6)
  updated_at                                                   DateTime?               @default(now()) @db.Timestamptz(6)
  supplier_return_items                                        supplier_return_items[]
  user_profiles_supplier_returns_approved_by_idTouser_profiles user_profiles?          @relation("supplier_returns_approved_by_idTouser_profiles", fields: [approved_by_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user_profiles_supplier_returns_created_by_idTouser_profiles  user_profiles?          @relation("supplier_returns_created_by_idTouser_profiles", fields: [created_by_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  purchase_orders                                              purchase_orders         @relation(fields: [purchase_order_id], references: [id], onUpdate: NoAction)
  suppliers                                                    suppliers               @relation(fields: [supplier_id], references: [id], onUpdate: NoAction)

  @@index([return_date(sort: Desc)], map: "idx_supplier_returns_date")
  @@index([return_number], map: "idx_supplier_returns_number")
  @@index([purchase_order_id], map: "idx_supplier_returns_po")
  @@index([status], map: "idx_supplier_returns_status")
  @@index([supplier_id], map: "idx_supplier_returns_supplier")
  @@schema("public")
}

model customer_receivables {
  id              String       @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  customer_id     String       @db.Uuid
  sales_order_id  String       @unique @db.Uuid
  original_amount Decimal      @db.Decimal(10, 2)
  paid_amount     Decimal?     @default(0) @db.Decimal(10, 2)
  balance         Decimal      @db.Decimal(10, 2)
  status          String?      @default("unpaid") @db.VarChar(20)
  due_date        DateTime?    @db.Timestamptz(6)
  created_at      DateTime?    @default(now()) @db.Timestamptz(6)
  updated_at      DateTime?    @default(now()) @db.Timestamptz(6)
  customers       customers    @relation(fields: [customer_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  sales_orders    sales_orders @relation(fields: [sales_order_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([customer_id], map: "idx_customer_receivables_customer")
  @@index([due_date], map: "idx_customer_receivables_due_date")
  @@index([status], map: "idx_customer_receivables_status")
  @@schema("public")
}

model stores {
  id                   String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                 String           @db.VarChar(100)
  code                 String           @unique @db.VarChar(20)
  address              String?
  city                 String?          @db.VarChar(100)
  phone                String?          @db.VarChar(20)
  email                String?          @db.VarChar(255)
  is_active            Boolean          @default(true)
  is_default           Boolean          @default(false)
  default_warehouse_id String?          @db.Uuid
  created_at           DateTime         @default(now()) @db.Timestamptz(6)
  updated_at           DateTime         @default(now()) @db.Timestamptz(6)
  sales_orders         sales_orders[]
  service_orders       service_orders[]
  stock_locations      stock_locations? @relation(fields: [default_warehouse_id], references: [id], onUpdate: NoAction)

  @@index([code], map: "idx_stores_code")
  @@index([is_active], map: "idx_stores_is_active")
  @@schema("public")
}

enum owner_type {
  individual
  company

  @@schema("public")
}

enum payment_method {
  cash
  card
  transfer
  ewallet_momo
  ewallet_zalopay
  ewallet_vnpay
  bank_transfer

  @@schema("public")
}

enum priority_level {
  low
  normal
  high
  urgent

  @@schema("public")
}

enum service_status {
  pending
  confirmed
  in_progress
  waiting_parts
  waiting_approval
  quality_check
  completed
  ready_for_pickup
  delivered
  cancelled

  @@schema("public")
}

enum user_role {
  sales
  technician
  manager
  finance
  store_manager
  sales_associate
  warehouse_staff

  @@schema("public")
}

enum image_entity_type {
  bike
  service_order
  customer
  part
  comment
  service_item

  @@schema("public")
}

enum purchase_order_payment_status {
  unpaid
  partially_paid
  paid

  @@schema("public")
}

enum purchase_order_status {
  draft
  pending_approval
  approved
  rejected
  cancelled

  @@schema("public")
}

enum supplier_transaction_type {
  purchase
  return
  payment

  @@schema("public")
}
